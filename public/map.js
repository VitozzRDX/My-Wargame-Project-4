import * as hexFunctions from './HexFunctions.js'

function Point(x, y) {
	return { x: x, y: y };
};

function hex_to_pixel(layout, h) {
	var M = layout.orientation;
	var size = layout.size;
	var origin = layout.origin;
	var x = (M.f0 * h.q + M.f1 * h.r) * size.x;
	var y = (M.f2 * h.q + M.f3 * h.r) * size.y;
	return Point(x + origin.x, y + origin.y);
};

function center_of_hex(layout, h) {
	return hex_to_pixel(layout, h);
};

function Hex(q, r, s) {
	if (Math.round(q + r + s) !== 0) throw "q + r + s must be 0";
	return { q: q, r: r, s: s };
};

function hex_round(h)
{
    var qi = Math.round(h.q);
    var ri = Math.round(h.r);
    var si = Math.round(h.s);
    var q_diff = Math.abs(qi - h.q);
    var r_diff = Math.abs(ri - h.r);
    var s_diff = Math.abs(si - h.s);
    if (q_diff > r_diff && q_diff > s_diff)
    {
        qi = -ri - si;
    }
    else
        if (r_diff > s_diff)
        {
            ri = -qi - si;
        }
        else
        {
            si = -qi - ri;
        }
    return Hex(qi, ri, si);
};

function hex_subtract(a, b)
{
    return Hex(a.q - b.q, a.r - b.r, a.s - b.s);
};

function hex_length(hex)
{
    return (Math.abs(hex.q) + Math.abs(hex.r) + Math.abs(hex.s)) / 2;
};

function hex_distance(a, b)                 // a {q:q,r:r..}
{
    return hex_length(hex_subtract(a, b));
};

function hex_lerp(a, b, t)
{
    return Hex(a.q * (1.0 - t) + b.q * t, a.r * (1.0 - t) + b.r * t, a.s * (1.0 - t) + b.s * t);
};

function hex_linedraw(a, b)
{
    var N = hex_distance(a, b);

    var results = [];
    var step = 1.0 / Math.max(N, 1);
    for (var i = 1; i <= N-1; i++)
    {
        results.push(hex_round(hex_lerp(a, b, step * i)));
    }
    return results;
};

function pointCircleCollide(point, circle, r) {


    if (r===0) return false

    //console.log('circle[0]',circle[0])
    //console.log('point[0]',point[0])

    var dx = circle.x - point[0]
    var dy = circle.y - point[1]

    //console.log('dx,dy,r',[dx,dy,r])

    var bool = dx * dx + dy * dy <= r * r
    //console.log('dx * dx + dy * dy <= r * r',bool)
    
    return dx * dx + dy * dy <= r * r
};

function lineCircleCollide(a, b, circle, radius) {
    // console.log('')
    // console.log('we are inside lineCircleCollide')
    // console.log('got centerOfOwnHex,centerOfHexClicked,circle,radius :',[a, b, circle, radius])
    //check to see if start or end points lie within circle 
   
    var x1 = a.x,
        y1 = a.y,
        x2 = b.x,
        y2 = b.y,
        cx = circle.x,
        cy = circle.y

    //vector d
    var dx = x2 - x1
    var dy = y2 - y1
    
    //vector lc
    var lcx = cx - x1
    var lcy = cy - y1
    
    //project lc onto d, resulting in vector p
    var dLen2 = dx * dx + dy * dy //len2 of d
    var px = dx
    var py = dy
    if (dLen2 > 0) {
        var dp = (lcx * dx + lcy * dy) / dLen2
        px *= dp
        py *= dp
    }
    

    var nearest = [];

    nearest[0] = x1 + px
    nearest[1] = y1 + py
    
    //len2 of p
    var pLen2 = px * px + py * py
    
    //check collision
    //console.log('nearest',nearest)
    return pointCircleCollide(nearest, circle, radius)
            && pLen2 <= dLen2 && (px * dx + py * dy) >= 0
};


function doLineSegmentsIntersect(l1, l2) {  // l = [{x:num,y:num},{}]

    console.log('inside doLineSegmentsIntersect(l1, l2) :',[l1, l2])

    var p = l1[0]

    var p2 = l1[1];

    var q = l2[0];
    var q2 = l2[1];
    var r = subtractPoints(p2, p);
    var s = subtractPoints(q2, q);

    var uNumerator = crossProduct(subtractPoints(q, p), r);
    var denominator = crossProduct(r, s);

    if (uNumerator == 0 && denominator == 0) {
        // They are coLlinear
        
        // Do they touch? (Are any of the points equal?)
        if (equalPoints(p, q) || equalPoints(p, q2) || equalPoints(p2, q) || equalPoints(p2, q2)) {
            return true
        }
        // Do they overlap? (Are all the point differences in either direction the same sign)
        return !allEqual(
                (q.x - p.x < 0),
                (q.x - p2.x < 0),
                (q2.x - p.x < 0),
                (q2.x - p2.x < 0)) ||
            !allEqual(
                (q.y - p.y < 0),
                (q.y - p2.y < 0),
                (q2.y - p.y < 0),
                (q2.y - p2.y < 0));
    }

    if (denominator == 0) {
        console.log('lines are paralell')
        // lines are paralell
        return false;
    }

    var u = uNumerator / denominator;
    var t = crossProduct(subtractPoints(q, p), s) / denominator;
//------------------------------------------------------------add-on-------------

    let x = p.x + t * (p2.x - p.x)
    let y = p.y + t * (p2.y - p.y)
//---------------------------------------------------------------
    if((t >= 0) && (t <= 1) && (u >= 0) && (u <= 1)) {
        return {'bool':true,'obstaclePoint':[x,y]}
    }

    return {'bool':false,'obstaclePoint':null}
}

function subtractPoints(point1, point2) {
    var result = {};
    result.x = point1.x - point2.x;
    result.y = point1.y - point2.y;

    return result;
}

function crossProduct(point1, point2) {
    return point1.x * point2.y - point1.y * point2.x;
}
function equalPoints(point1, point2) {
    return (point1.x == point2.x) && (point1.y == point2.y)
}

function allEqual(args) {
    var firstValue = arguments[0],
        i;
    for (i = 1; i < arguments.length; i += 1) {
        if (arguments[i] != firstValue) {
            return false;
        }
    }
    return true;
}


class Map {
    constructor() {
        this.hexTerrainTable = {
            '{"q":16,"r":-7,"s":-9}': {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":894,"y":81},{"x":881,"y":65}],
                    [{"x":881,"y":65},{"x":906,"y":48}],
                    [{"x":906,"y":48},{"x":920,"y":63}],
                    [{"x":920,"y":63},{"x":895,"y":81}]
                ]
            },
            '{"q":7,"r":-1,"s":-6}': {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":410,"y":171},{"x":374,"y":172}],
                    [{"x":374,"y":172},{"x":373,"y":153}],
                    [{"x":373,"y":153},{"x":381,"y":145}],
                    [{"x":381,"y":145},{"x":387,"y":141}],
                    [{"x":387,"y":141},{"x":395,"y":142}],
                    [{"x":395,"y":142},{"x":400,"y":146}],
                    [{"x":400,"y":146},{"x":411,"y":153}],
                    [{"x":411,"y":153},{"x":411,"y":171}]
                ]
            },
            '{"q":8,"r":-2,"s":-6}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":482,"y":123},{"x":444,"y":146}],
                    [{"x":444,"y":146},{"x":434,"y":127}],
                    [{"x":434,"y":127},{"x":459,"y":112}],
                    [{"x":459,"y":112},{"x":458,"y":107}],
                    [{"x":458,"y":107},{"x":470,"y":98}]
                ]
            },
            '{"q":9,"r":-3,"s":-6}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":484,"y":123},{"x":524,"y":100}],
                    [{"x":524,"y":100},{"x":513,"y":81}],
                    [{"x":513,"y":81},{"x":504,"y":80}],
                    [{"x":504,"y":80},{"x":497,"y":84}],
                    [{"x":497,"y":84},{"x":486,"y":92}],
                    [{"x":486,"y":92},{"x":470,"y":100}]
                ]
            },
            '{"q":11,"r":-4,"s":-7}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":600,"y":94},{"x":627,"y":109}],
                    [{"x":627,"y":109},{"x":639,"y":92}],
                    [{"x":639,"y":92},{"x":613,"y":75}],
                    [{"x":613,"y":75},{"x":601,"y":93}]
                ]
            },
            '{"q":12,"r":-4,"s":-8}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":679,"y":152},{"x":671,"y":145}],
                    [{"x":671,"y":145},{"x":666,"y":140}],
                    [{"x":666,"y":140},{"x":654,"y":120}],
                    [{"x":654,"y":120},{"x":676,"y":105}],
                    [{"x":676,"y":105},{"x":689,"y":118}],
                    [{"x":689,"y":118},{"x":686,"y":128}],
                    [{"x":686,"y":128},{"x":689,"y":143}],
                    [{"x":689,"y":143},{"x":679,"y":152}]
                ]
            },
            '{"q":19,"r":-8,"s":-11}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":1069,"y":118},{"x":1054,"y":80}],
                    [{"x":1054,"y":80},{"x":1083,"y":72}],
                    [{"x":1083,"y":72},{"x":1088,"y":89}],
                    [{"x":1088,"y":89},{"x":1083,"y":95}],
                    [{"x":1083,"y":95},{"x":1077,"y":97}],
                    [{"x":1077,"y":97},{"x":1082,"y":111}],
                    [{"x":1082,"y":111},{"x":1071,"y":117}]
                ]
            },
            '{"q":10,"r":-2,"s":-8}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":571,"y":225},{"x":578,"y":218}],
                    [{"x":578,"y":218},{"x":577,"y":196}],
                    [{"x":577,"y":196},{"x":572,"y":181}],
                    [{"x":572,"y":181},{"x":551,"y":181}],
                    [{"x":551,"y":181},{"x":546,"y":198}],
                    [{"x":546,"y":198},{"x":547,"y":215}],
                    [{"x":547,"y":215},{"x":550,"y":225}]
                ]
            },
            '{"q":10,"r":-1,"s":-9}' : {
                type : 'stone house',
                obstacleLines :[ 
                    [{"x":550,"y":226},{"x":548,"y":252}],
                    [{"x":548,"y":252},{"x":548,"y":267}],
                    [{"x":548,"y":267},{"x":550,"y":291}],
                    [{"x":579,"y":228},{"x":579,"y":256}],
                    [{"x":579,"y":256},{"x":573,"y":290}]
                ]
            },
            '{"q":10,"r":0,"s":-10}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":551,"y":291},{"x":547,"y":320}],
                    [{"x":547,"y":320},{"x":547,"y":330}],
                    [{"x":547,"y":330},{"x":552,"y":337}],
                    [{"x":552,"y":337},{"x":583,"y":337}],
                    [{"x":583,"y":337},{"x":583,"y":316}],
                    [{"x":583,"y":316},{"x":578,"y":308}],
                    [{"x":578,"y":308},{"x":578,"y":299}],
                    [{"x":578,"y":299},{"x":573,"y":292}]
                ]
            },
            '{"q":13,"r":-3,"s":-10}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":765,"y":221},{"x":732,"y":242}],
                    [{"x":732,"y":242},{"x":716,"y":222}],
                    [{"x":716,"y":222},{"x":752,"y":198}]
                ]
            },
            '{"q":14,"r":-4,"s":-10}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":766,"y":221},{"x":803,"y":196}],
                    [{"x":803,"y":196},{"x":788,"y":174}],
                    [{"x":788,"y":174},{"x":752,"y":197}]
                ]
            },
            '{"q":15,"r":-4,"s":-11}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":830,"y":241},{"x":827,"y":222}],
                    [{"x":827,"y":222},{"x":827,"y":211}],
                    [{"x":827,"y":211},{"x":835,"y":206}],
                    [{"x":835,"y":206},{"x":862,"y":206}],
                    [{"x":862,"y":206},{"x":863,"y":242}],
                    [{"x":863,"y":242},{"x":833,"y":242}]
                ]
            },
            '{"q":17,"r":-5,"s":-12}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":941,"y":193},{"x":942,"y":239}],
                    [{"x":942,"y":239},{"x":969,"y":239}],
                    [{"x":969,"y":239},{"x":974,"y":219}],
                    [{"x":974,"y":219},{"x":974,"y":195}]
                ]
            },
            '{"q":17,"r":-6,"s":-11}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":975,"y":193},{"x":974,"y":168}],
                    [{"x":974,"y":168},{"x":969,"y":146}],
                    [{"x":969,"y":146},{"x":941,"y":145}],
                    [{"x":941,"y":145},{"x":941,"y":192}]
                ]
            },
            '{"q":19,"r":-6,"s":-13}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":1085,"y":240},{"x":1062,"y":242}],
                    [{"x":1062,"y":242},{"x":1062,"y":240}],
                    [{"x":1062,"y":240},{"x":1062,"y":209}],
                    [{"x":1062,"y":209},{"x":1084,"y":208}],
                    [{"x":1084,"y":208},{"x":1085,"y":241}]
                ]
            },
            '{"q":26,"r":-10,"s":-16}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":1085,"y":240},{"x":1062,"y":242}],
                    [{"x":1062,"y":242},{"x":1062,"y":240}],
                    [{"x":1062,"y":240},{"x":1062,"y":209}],
                    [{"x":1062,"y":209},{"x":1084,"y":208}],
                    [{"x":1084,"y":208},{"x":1085,"y":241}]
                ]
            },
            '{"q":12,"r":-2,"s":-10}' : {
                type : 'stone house',
                obstacleLines :[ 
                    [{"x":665,"y":290},{"x":664,"y":268}],
                    [{"x":664,"y":268},{"x":666,"y":241}],
                    [{"x":666,"y":241},{"x":686,"y":240}],
                    [{"x":686,"y":240},{"x":689,"y":267}],
                    [{"x":689,"y":267},{"x":688,"y":289}]
                ]
            },
            '{"q":12,"r":-1,"s":-11}' : {
                type : 'stone house',
                obstacleLines :[ 
                    [{"x":688,"y":290},{"x":687,"y":333}],
                    [{"x":687,"y":333},{"x":668,"y":334}],
                    [{"x":668,"y":334},{"x":661,"y":326}],
                    [{"x":661,"y":326},{"x":659,"y":301}],
                    [{"x":659,"y":301},{"x":665,"y":292}]
                ]
            },
            '{"q":13,"r":-1,"s":-12}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":751,"y":327},{"x":719,"y":348}],
                    [{"x":719,"y":348},{"x":731,"y":369}],
                    [{"x":731,"y":369},{"x":765,"y":350}]
                ]
            },
            '{"q":14,"r":-2,"s":-12}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":767,"y":350},{"x":805,"y":327}],
                    [{"x":805,"y":327},{"x":790,"y":304}],
                    [{"x":790,"y":304},{"x":754,"y":326}]
                ]
            },
            '{"q":15,"r":-3,"s":-12}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":853,"y":310},{"x":827,"y":297}],
                    [{"x":827,"y":297},{"x":839,"y":271}],
                    [{"x":839,"y":271},{"x":867,"y":285}],
                    [{"x":867,"y":285},{"x":853,"y":310}]
                ]
            },
            '{"q":17,"r":-3,"s":-14}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":938,"y":355},{"x":968,"y":335}],
                    [{"x":968,"y":335},{"x":984,"y":353}],
                    [{"x":984,"y":353},{"x":948,"y":377}],
                    [{"x":948,"y":377},{"x":937,"y":356}]
                ]
            },
            '{"q":5,"r":3,"s":-8}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":300,"y":380},{"x":292,"y":377}],
                    [{"x":292,"y":377},{"x":279,"y":377}],
                    [{"x":279,"y":377},{"x":266,"y":380}],
                    [{"x":266,"y":380},{"x":261,"y":377}],
                    [{"x":261,"y":377},{"x":261,"y":366}],
                    [{"x":261,"y":366},{"x":261,"y":346}],
                    [{"x":261,"y":346},{"x":270,"y":337}],
                    [{"x":270,"y":337},{"x":291,"y":334}],
                    [{"x":291,"y":334},{"x":300,"y":326}]
                ] 
            },
            '{"q":6,"r":2,"s":-8}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":303,"y":327},{"x":310,"y":314}],
                    [{"x":310,"y":314},{"x":330,"y":302}],
                    [{"x":330,"y":302},{"x":347,"y":301}],
                    [{"x":347,"y":301},{"x":360,"y":299}]
                ]
            },
            '{"q":7,"r":1,"s":-8}' : {
                type : 'hill',
                obstacleLines : [
                    [{"x":360,"y":299},{"x":362,"y":297}],
                    [{"x":362,"y":297},{"x":366,"y":294}],
                    [{"x":366,"y":294},{"x":373,"y":281}],
                    [{"x":373,"y":281},{"x":378,"y":269}],
                    [{"x":378,"y":269},{"x":387,"y":268}],
                    [{"x":387,"y":268},{"x":403,"y":268}],
                    [{"x":403,"y":268},{"x":414,"y":267}]
                ]
            },
            '{"q":8,"r":0,"s":-8}' : {
                type : 'hill',
                obstacleLines :[
                    [{"x":414,"y":267},{"x":417,"y":264}],
                    [{"x":417,"y":264},{"x":432,"y":258}],
                    [{"x":432,"y":258},{"x":441,"y":254}],
                    [{"x":441,"y":254},{"x":450,"y":241}],
                    [{"x":450,"y":241},{"x":471,"y":231}]
                ]
            },

            '{"q":9,"r":-1,"s":-8}' : {
                type : 'hill',
                obstacleLines :[
                    [{"x":472,"y":229},{"x":478,"y":226}],
                    [{"x":478,"y":226},{"x":491,"y":216}],
                    [{"x":491,"y":216},{"x":500,"y":205}],
                    [{"x":500,"y":205},{"x":517,"y":199}],
                    [{"x":517,"y":199},{"x":524,"y":202}],
                    [{"x":524,"y":202},{"x":525,"y":211}],
                    [{"x":525,"y":211},{"x":530,"y":222}],
                    [{"x":530,"y":222},{"x":530,"y":232}],
                    [{"x":530,"y":232},{"x":519,"y":257}]
                ]
            },

            '{"q":9,"r":0,"s":-9}' : {
                type : 'hill',
                obstacleLines :[
                    [{"x":519,"y":259},{"x":520,"y":295}],
                    [{"x":520,"y":295},{"x":518,"y":323}]
                ]
            },
            '{"q":9,"r":1,"s":-10}' : {
                type : 'hill',
                obstacleLines :[
                    [{"x":518,"y":324},{"x":525,"y":345}],
                    [{"x":525,"y":345},{"x":527,"y":356}],
                    [{"x":527,"y":356},{"x":509,"y":376}],
                    [{"x":509,"y":376},{"x":495,"y":375}],
                    [{"x":495,"y":375},{"x":485,"y":380}]
                ]
            },
            '{"q":8,"r":2,"s":-10}' : {
                type : 'hill',
                obstacleLines :[
                    [{"x":481,"y":380},{"x":460,"y":411}],
                    [{"x":460,"y":411},{"x":431,"y":418}]
                ]
            },
            '{"q":7,"r":3,"s":-10}' : {
                type : 'hill',
                obstacleLines :[
                    [{"x":429,"y":417},{"x":416,"y":422}],
                    [{"x":416,"y":422},{"x":396,"y":442}],
                    [{"x":396,"y":442},{"x":389,"y":444}],
                    [{"x":389,"y":444},{"x":381,"y":440}],
                    [{"x":381,"y":440},{"x":373,"y":427}],
                    [{"x":373,"y":427},{"x":366,"y":421}],
                    [{"x":366,"y":421},{"x":360,"y":416}]
                ]
            },
            '{"q":8,"r":2,"s":-10}' : {
                type : 'hill',
                obstacleLines :[ 
                    [{"x":357,"y":416},{"x":325,"y":415}],
                    [{"x":325,"y":415},{"x":316,"y":407}],
                    [{"x":316,"y":407},{"x":312,"y":394}],
                    [{"x":312,"y":394},{"x":303,"y":385}]
                ]
            },
            '{"q":-1,"r":8,"s":-7}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":296,"y":501},{"x":279,"y":502}],
                    [{"x":279,"y":502},{"x":278,"y":505}],
                    [{"x":278,"y":505},{"x":264,"y":505}],
                    [{"x":264,"y":505},{"x":265,"y":472}],
                    [{"x":265,"y":472},{"x":271,"y":468}],
                    [{"x":271,"y":468},{"x":296,"y":467}],
                    [{"x":296,"y":467},{"x":297,"y":502}]
                ]
            },
            '{"q":9,"r":3,"s":-12}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":529,"y":491},{"x":518,"y":492}],
                    [{"x":518,"y":492},{"x":519,"y":502}],
                    [{"x":519,"y":502},{"x":489,"y":502}],
                    [{"x":489,"y":502},{"x":487,"y":492}],
                    [{"x":487,"y":492},{"x":488,"y":469}],
                    [{"x":488,"y":469},{"x":501,"y":464}],
                    [{"x":501,"y":464},{"x":516,"y":464}],
                    [{"x":516,"y":464},{"x":528,"y":468}],
                    [{"x":528,"y":468},{"x":530,"y":491}]
                ]
            },
            '{"q":10,"r":2,"s":-12}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":589,"y":452},{"x":547,"y":469}],
                    [{"x":547,"y":469},{"x":539,"y":465}],
                    [{"x":539,"y":465},{"x":534,"y":455}],
                    [{"x":534,"y":455},{"x":581,"y":435}],
                    [{"x":581,"y":435},{"x":590,"y":452}]
                ]
            },
            '{"q":10,"r":3,"s":-13}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":578,"y":524},{"x":555,"y":533}],
                    [{"x":555,"y":533},{"x":544,"y":512}],
                    [{"x":544,"y":512},{"x":568,"y":501}],
                    [{"x":568,"y":501},{"x":579,"y":523}]
                ]
            },
            '{"q":12,"r":1,"s":-13}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":694,"y":458},{"x":670,"y":468}],
                    [{"x":670,"y":468},{"x":668,"y":468}],
                    [{"x":668,"y":468},{"x":659,"y":447}],
                    [{"x":659,"y":447},{"x":682,"y":435}],
                    [{"x":682,"y":435},{"x":695,"y":458}]
                ]
            },
            '{"q":14,"r":0,"s":-14}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":809,"y":480},{"x":789,"y":465}],
                    [{"x":789,"y":465},{"x":780,"y":458}],
                    [{"x":780,"y":458},{"x":800,"y":434}],
                    [{"x":800,"y":434},{"x":824,"y":453}]
                ]
            },
            '{"q":15,"r":0,"s":-15}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":811,"y":479},{"x":839,"y":504}],
                    [{"x":839,"y":504},{"x":857,"y":485}],
                    [{"x":857,"y":485},{"x":827,"y":455}]
                ]
            },
            '{"q":15,"r":-1,"s":-14}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":860,"y":438},{"x":836,"y":438}],
                    [{"x":836,"y":438},{"x":833,"y":435}],
                    [{"x":833,"y":435},{"x":834,"y":406}],
                    [{"x":834,"y":406},{"x":837,"y":404}],
                    [{"x":837,"y":404},{"x":858,"y":403}],
                    [{"x":858,"y":403},{"x":859,"y":424}],
                    [{"x":859,"y":424},{"x":860,"y":438}]
                ]
            },
            '{"q":16,"r":0,"s":-16}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":882,"y":502},{"x":900,"y":491}],
                    [{"x":900,"y":491},{"x":912,"y":506}],
                    [{"x":912,"y":506},{"x":921,"y":519}],
                    [{"x":921,"y":519},{"x":927,"y":528}],
                    [{"x":927,"y":528},{"x":900,"y":546}],
                    [{"x":900,"y":546},{"x":892,"y":537}],
                    [{"x":892,"y":537},{"x":902,"y":529}],
                    [{"x":902,"y":529},{"x":892,"y":517}],
                    [{"x":892,"y":517},{"x":883,"y":502}]
                ]
            },
            '{"q":17,"r":-1,"s":-16}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":975,"y":492},{"x":955,"y":491}],
                    [{"x":955,"y":491},{"x":955,"y":499}],
                    [{"x":955,"y":499},{"x":942,"y":498}],
                    [{"x":942,"y":498},{"x":942,"y":476}],
                    [{"x":942,"y":476},{"x":944,"y":471}],
                    [{"x":944,"y":471},{"x":975,"y":468}],
                    [{"x":975,"y":468},{"x":976,"y":490}]
                ]
            },
            '{"q":23,"r":-3,"s":-20}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":1312,"y":559},{"x":1307,"y":567}],
                    [{"x":1307,"y":567},{"x":1283,"y":565}],
                    [{"x":1283,"y":565},{"x":1276,"y":549}],
                    [{"x":1276,"y":549},{"x":1275,"y":539}],
                    [{"x":1275,"y":539},{"x":1282,"y":534}],
                    [{"x":1282,"y":534},{"x":1307,"y":534}],
                    [{"x":1307,"y":534},{"x":1312,"y":539}],
                    [{"x":1312,"y":539},{"x":1313,"y":559}]
                ]
            },
            '{"q":33,"r":-10,"s":-23}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":1869,"y":435},{"x":1843,"y":434}],
                    [{"x":1843,"y":434},{"x":1843,"y":404}],
                    [{"x":1843,"y":404},{"x":1868,"y":404}],
                    [{"x":1868,"y":404},{"x":1870,"y":435}]
                ]
            },
            '{"q":8,"r":5,"s":-13}' : {
                type : 'wooden house',
                obstacleLines :[
                    [{"x":467,"y":596},{"x":445,"y":601}],
                    [{"x":445,"y":601},{"x":439,"y":596}],
                    [{"x":439,"y":596},{"x":432,"y":569}],
                    [{"x":432,"y":569},{"x":459,"y":563}],
                    [{"x":459,"y":563},{"x":467,"y":596}]
                ]
            },
            '{"q":13,"r":2,"s":-15}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":751,"y":578},{"x":713,"y":557}],
                    [{"x":713,"y":557},{"x":725,"y":532}],
                    [{"x":725,"y":532},{"x":734,"y":527}],
                    [{"x":734,"y":527},{"x":760,"y":541}],
                    [{"x":760,"y":541},{"x":757,"y":548}],
                    [{"x":757,"y":548},{"x":766,"y":553}]
                ]
            },
            '{"q":14,"r":2,"s":-16}' : {
                type : 'stone house',
                obstacleLines :[
                    [{"x":767,"y":554},{"x":808,"y":576}],
                    [{"x":808,"y":576},{"x":795,"y":600}],
                    [{"x":795,"y":600},{"x":752,"y":579}]
                ]
            },
            '{"q":9,"r":5,"s":-14}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":473,"y":620},{"x":479,"y":615}],
                    [{"x":479,"y":615},{"x":492,"y":603}],
                    [{"x":492,"y":603},{"x":508,"y":598}],
                    [{"x":508,"y":598},{"x":527,"y":601}],
                    [{"x":527,"y":601},{"x":533,"y":612}],
                    [{"x":533,"y":612},{"x":524,"y":624}],
                    [{"x":524,"y":624},{"x":509,"y":630}],
                    [{"x":509,"y":630},{"x":492,"y":634}],
                    [{"x":492,"y":634},{"x":486,"y":638}]
                ]
            },
            '{"q":8,"r":6,"s":-14}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":482,"y":639},{"x":477,"y":645}],
                    [{"x":477,"y":645},{"x":468,"y":658}],
                    [{"x":468,"y":658},{"x":455,"y":668}],
                    [{"x":455,"y":668},{"x":449,"y":668}],
                    [{"x":449,"y":668},{"x":440,"y":660}],
                    [{"x":440,"y":660},{"x":427,"y":649}],
                    [{"x":427,"y":649},{"x":417,"y":641}],
                    [{"x":428,"y":619},{"x":439,"y":626}],
                    [{"x":439,"y":626},{"x":454,"y":629}],
                    [{"x":454,"y":629},{"x":466,"y":627}],
                    [{"x":466,"y":627},{"x":472,"y":620}]
                ]
            },
            '{"q":7,"r":6,"s":-13}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":415,"y":640},{"x":409,"y":635}],
                    [{"x":409,"y":635},{"x":393,"y":633}],
                    [{"x":393,"y":633},{"x":384,"y":634}],
                    [{"x":384,"y":634},{"x":372,"y":639}],
                    [{"x":408,"y":582},{"x":411,"y":600}],
                    [{"x":411,"y":600},{"x":416,"y":610}],
                    [{"x":416,"y":610},{"x":426,"y":620}]
                ]
            },
            '{"q":6,"r":7,"s":-13}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":370,"y":638},{"x":361,"y":645}],
                    [{"x":361,"y":645},{"x":357,"y":653}],
                    [{"x":357,"y":653},{"x":343,"y":666}],
                    [{"x":343,"y":666},{"x":334,"y":666}],
                    [{"x":334,"y":666},{"x":323,"y":654}],
                    [{"x":323,"y":654},{"x":315,"y":644}],
                    [{"x":315,"y":644},{"x":311,"y":638}],
                    [{"x":311,"y":638},{"x":307,"y":638}]
                ]
            },
            '{"q":5,"r":7,"s":-12}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":303,"y":636},{"x":286,"y":630}],
                    [{"x":286,"y":630},{"x":277,"y":627}],
                    [{"x":277,"y":627},{"x":265,"y":632}],
                    [{"x":265,"y":632},{"x":259,"y":637}]
                ]
            },
            '{"q":4,"r":8,"s":-12}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":258,"y":638},{"x":228,"y":664}],
                    [{"x":228,"y":664},{"x":220,"y":667}],
                    [{"x":220,"y":667},{"x":214,"y":663}],
                    [{"x":214,"y":663},{"x":201,"y":645}],
                    [{"x":201,"y":645},{"x":214,"y":615}]
                ]
            },
            '{"q":4,"r":7,"s":-11}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":214,"y":612},{"x":209,"y":595}],
                    [{"x":209,"y":595},{"x":213,"y":587}],
                    [{"x":213,"y":587},{"x":212,"y":577}],
                    [{"x":212,"y":577},{"x":218,"y":570}],
                    [{"x":218,"y":570},{"x":248,"y":559}]
                ]
            },
            '{"q":5,"r":6,"s":-11}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":250,"y":558},{"x":257,"y":550}],
                    [{"x":257,"y":550},{"x":262,"y":539}],
                    [{"x":262,"y":539},{"x":272,"y":533}],
                    [{"x":272,"y":533},{"x":290,"y":531}],
                    [{"x":290,"y":531},{"x":302,"y":520}]
                ]
            },
            '{"q":6,"r":5,"s":-11}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":304,"y":520},{"x":309,"y":514}],
                    [{"x":309,"y":514},{"x":318,"y":502}],
                    [{"x":318,"y":502},{"x":330,"y":495}],
                    [{"x":330,"y":495},{"x":350,"y":501}],
                    [{"x":350,"y":501},{"x":362,"y":511}],
                    [{"x":362,"y":511},{"x":369,"y":526}]
                ]
            },
            '{"q":7,"r":5,"s":-12}': {
                type : 'hill',
                obstacleLines :[
                    [{"x":370,"y":526},{"x":393,"y":539}],
                    [{"x":393,"y":539},{"x":396,"y":537}],
                    [{"x":396,"y":537},{"x":407,"y":544}],
                    [{"x":407,"y":544},{"x":411,"y":554}],
                    [{"x":411,"y":554},{"x":407,"y":572}],
                    [{"x":407,"y":572},{"x":407,"y":579}]
                ]
            },
            '{"q":4,"r":1,"s":-5}': {
                type : 'forest',
                obstaclePoints :[
                    {"x":235,"y":214},{"x":238,"y":208},
                    {"x":242,"y":203},{"x":247,"y":199},
                    {"x":245,"y":197},{"x":238,"y":198},
                    {"x":234,"y":192},{"x":229,"y":187},
                    {"x":231,"y":180},{"x":232,"y":175},
                    {"x":230,"y":170},{"x":230,"y":166},
                    {"x":230,"y":211},{"x":223,"y":209},
                    {"x":217,"y":206},{"x":211,"y":202},
                    {"x":207,"y":197},{"x":206,"y":192},
                    {"x":208,"y":185},{"x":209,"y":179},
                    {"x":210,"y":172},{"x":208,"y":167}
                ]
            },
            '{"q":4,"r":0,"s":-4}': {
                type : 'forest',
                obstaclePoints :[{"x":211,"y":158},{"x":212,"y":151},{"x":208,"y":147},{"x":207,"y":141},
                {"x":203,"y":136},{"x":200,"y":131},{"x":202,"y":124},{"x":201,"y":118},{"x":204,"y":112},
                {"x":210,"y":109},{"x":213,"y":103},{"x":212,"y":98},{"x":230,"y":158},{"x":228,"y":151},
                {"x":229,"y":144},{"x":233,"y":140},{"x":238,"y":137},{"x":243,"y":134},{"x":244,"y":128},
                {"x":246,"y":121},{"x":250,"y":118}]
            },
            '{"q":4,"r":-1,"s":-3}': {
                type : 'forest',
                obstaclePoints :[{"x":209,"y":93},{"x":207,"y":87},{"x":204,"y":81},{"x":200,"y":78},
                {"x":197,"y":73},{"x":204,"y":73},{"x":209,"y":68},{"x":209,"y":61},{"x":205,"y":55},
                {"x":203,"y":50},{"x":207,"y":48},{"x":213,"y":45},{"x":219,"y":46},{"x":223,"y":43},
                {"x":227,"y":42},{"x":230,"y":44},{"x":227,"y":49},{"x":226,"y":55},{"x":228,"y":59},
                {"x":233,"y":63},{"x":239,"y":63},{"x":242,"y":58},{"x":245,"y":58},{"x":247,"y":62},
                {"x":250,"y":67},{"x":254,"y":70}]

            },
            '{"q":5,"r":-1,"s":-4}': {
                type : 'forest',
                obstaclePoints :[{"x":255,"y":117},{"x":260,"y":114},{"x":264,"y":115},{"x":268,"y":115},
                {"x":271,"y":109},{"x":278,"y":108},{"x":284,"y":107},{"x":288,"y":107},{"x":292,"y":110},
                {"x":294,"y":106},{"x":292,"y":101},{"x":295,"y":95},{"x":293,"y":89},{"x":291,"y":82},
                {"x":290,"y":77},{"x":285,"y":76},{"x":284,"y":87},{"x":279,"y":90},{"x":273,"y":94},
                {"x":267,"y":91},{"x":267,"y":84},{"x":263,"y":82},{"x":259,"y":78},{"x":256,"y":74}]

            },
            '{"q":3,"r":3,"s":-6}': {
                type : 'forest',
                obstaclePoints :[{"x":113,"y":284},{"x":117,"y":279},{"x":121,"y":278},{"x":126,"y":277},
                {"x":122,"y":270},{"x":117,"y":264},{"x":120,"y":257},{"x":125,"y":256},{"x":123,"y":250},
                {"x":121,"y":246},{"x":115,"y":245}]

            },
            '{"q":6,"r":2,"s":-8}': {
                type : 'garden',
                obstaclePoints :[{"x":321,"y":318},{"x":326,"y":318},{"x":329,"y":312},{"x":324,"y":308},
                {"x":320,"y":311},{"x":343,"y":316},{"x":347,"y":318},{"x":351,"y":319},{"x":354,"y":316},
                {"x":351,"y":310},{"x":346,"y":310},{"x":344,"y":335},{"x":349,"y":337},{"x":350,"y":341},
                {"x":349,"y":344},{"x":345,"y":345},{"x":342,"y":343},{"x":323,"y":343},{"x":326,"y":339},
                {"x":326,"y":336},{"x":322,"y":333},{"x":319,"y":337},{"x":320,"y":340}]

            },
            '{"q":7,"r":2,"s":-9}': {
                type : 'garden',
                obstaclePoints :[{"x":369,"y":365},{"x":373,"y":367},{"x":377,"y":369},{"x":379,"y":364},
                {"x":378,"y":359},{"x":372,"y":360},{"x":394,"y":370},{"x":396,"y":374},{"x":400,"y":374},
                {"x":405,"y":370},{"x":405,"y":365},{"x":399,"y":364},{"x":396,"y":365},{"x":398,"y":343},
                {"x":401,"y":345},{"x":405,"y":345},{"x":408,"y":341},{"x":402,"y":337},{"x":378,"y":346},
                {"x":382,"y":344},{"x":384,"y":341},{"x":379,"y":336},{"x":375,"y":338},{"x":373,"y":342}]

            },
            '{"q":8,"r":1,"s":-9}': {
                type : 'garden',
                obstaclePoints :[{"x":435,"y":344},{"x":440,"y":344},{"x":442,"y":342},{"x":439,"y":337},
                {"x":440,"y":334},{"x":433,"y":335},{"x":432,"y":339},{"x":430,"y":342},{"x":457,"y":339},
                {"x":461,"y":343},{"x":466,"y":340},{"x":469,"y":335},{"x":466,"y":329},{"x":461,"y":332},
                {"x":459,"y":334},{"x":456,"y":316},{"x":462,"y":315},{"x":463,"y":312},{"x":460,"y":306},
                {"x":455,"y":307},{"x":454,"y":310},{"x":430,"y":319},{"x":435,"y":317},{"x":437,"y":317},
                {"x":441,"y":313},{"x":438,"y":310},{"x":434,"y":306},{"x":429,"y":308},{"x":430,"y":312}]

            },
            '{"q":11,"r":0,"s":-11}': {
                type : 'garden',
                obstaclePoints :[{"x":593,"y":359},{"x":598,"y":359},{"x":600,"y":356},{"x":601,"y":351},
                {"x":595,"y":349},{"x":591,"y":352},{"x":590,"y":355},{"x":603,"y":340},{"x":608,"y":341},
                {"x":611,"y":340},{"x":609,"y":334},{"x":604,"y":335},{"x":630,"y":340},{"x":633,"y":343},
                {"x":637,"y":345},{"x":638,"y":342},{"x":637,"y":337},{"x":635,"y":335},{"x":636,"y":357},
                {"x":639,"y":359},{"x":643,"y":359},{"x":642,"y":354},{"x":638,"y":355}]

            },
            '{"q":14,"r":-1,"s":-13}': {
                type : 'garden',
                obstaclePoints :[{"x":767,"y":382},{"x":772,"y":381},{"x":768,"y":375},{"x":763,"y":379},
                {"x":783,"y":374},{"x":788,"y":371},{"x":788,"y":367},{"x":784,"y":364},{"x":781,"y":368},
                {"x":798,"y":389},{"x":802,"y":386},{"x":805,"y":385},{"x":807,"y":389},{"x":808,"y":392},
                {"x":804,"y":395},{"x":800,"y":395},{"x":787,"y":400},{"x":786,"y":404},{"x":785,"y":408},
                {"x":779,"y":407},{"x":777,"y":408},{"x":776,"y":406},{"x":779,"y":401},{"x":783,"y":400}]

            },
            '{"q":15,"r":-2,"s":-13}': {
                type : 'garden',
                obstaclePoints :[{"x":831,"y":375},{"x":836,"y":378},{"x":841,"y":378},{"x":843,"y":376},
                {"x":844,"y":371},{"x":840,"y":370},{"x":836,"y":372},{"x":855,"y":372},{"x":860,"y":369},
                {"x":864,"y":368},{"x":864,"y":362},{"x":858,"y":362},{"x":856,"y":366},{"x":844,"y":345},
                {"x":848,"y":343},{"x":852,"y":339},{"x":850,"y":336},{"x":846,"y":334},{"x":843,"y":338},
                {"x":842,"y":342},{"x":828,"y":355},{"x":829,"y":350},{"x":828,"y":346},{"x":822,"y":346},
                {"x":820,"y":352},{"x":822,"y":355}]

            },
            '{"q":16,"r":-3,"s":-13}': {
                type : 'garden',
                obstaclePoints :[{"x":888,"y":344},{"x":892,"y":346},{"x":895,"y":348},{"x":899,"y":344},
                {"x":900,"y":339},{"x":895,"y":337},{"x":890,"y":338},{"x":875,"y":319},{"x":881,"y":320},
                {"x":884,"y":318},{"x":884,"y":312},{"x":880,"y":309},{"x":875,"y":313},{"x":896,"y":309},
                {"x":901,"y":308},{"x":903,"y":305},{"x":905,"y":300},{"x":898,"y":297},{"x":893,"y":301},
                {"x":908,"y":330},{"x":909,"y":334},{"x":914,"y":333},{"x":918,"y":334},{"x":918,"y":327},
                {"x":914,"y":324},{"x":911,"y":327}]

            },
            '{"q":17,"r":-4,"s":-13}': {
                type : 'garden',
                obstaclePoints :[{"x":946,"y":311},{"x":951,"y":314},{"x":956,"y":312},{"x":957,"y":308},
                {"x":953,"y":302},{"x":948,"y":306},{"x":967,"y":300},{"x":970,"y":305},{"x":974,"y":305},
                {"x":978,"y":302},{"x":980,"y":298},{"x":976,"y":294},{"x":970,"y":295},{"x":959,"y":278},
                {"x":965,"y":273},{"x":959,"y":269},{"x":953,"y":269},{"x":950,"y":273},{"x":955,"y":276},
                {"x":940,"y":286},{"x":943,"y":281},{"x":937,"y":277},{"x":933,"y":278},{"x":932,"y":284},
                {"x":930,"y":286},{"x":935,"y":288}]

            },
            '{"q":18,"r":-5,"s":-13}': {
                type : 'garden',
                obstaclePoints :[{"x":1006,"y":280},{"x":1011,"y":281},{"x":1017,"y":280},{"x":1015,"y":275},
                {"x":1014,"y":271},{"x":1009,"y":273},{"x":1026,"y":259},{"x":1032,"y":260},{"x":1031,"y":256},
                {"x":1034,"y":250},{"x":1026,"y":245},{"x":1029,"y":249},{"x":1023,"y":248},{"x":1023,"y":253},
                {"x":1004,"y":245},{"x":1005,"y":239},{"x":1001,"y":235},{"x":999,"y":237},{"x":995,"y":242},
                {"x":999,"y":249},{"x":994,"y":262},{"x":992,"y":256},{"x":993,"y":253},{"x":987,"y":254},
                {"x":985,"y":256},{"x":985,"y":261},{"x":988,"y":263}]

            },
            '{"q":18,"r":-6,"s":-12}': {
                type : 'garden',
                obstaclePoints :[{"x":995,"y":208},{"x":1002,"y":210},{"x":1003,"y":205},{"x":1004,"y":200},
                {"x":998,"y":196},{"x":994,"y":200},{"x":1022,"y":204},{"x":1020,"y":196},{"x":1026,"y":193},
                {"x":1029,"y":198},{"x":1032,"y":200},{"x":1026,"y":204},{"x":1026,"y":181},{"x":1020,"y":180},
                {"x":1020,"y":174},{"x":1023,"y":170},{"x":1026,"y":174},{"x":1030,"y":177},{"x":1000,"y":184},
                {"x":1002,"y":179},{"x":999,"y":173},{"x":994,"y":175},{"x":992,"y":180},{"x":994,"y":183}]

            },
            '{"q":18,"r":-7,"s":-11}': {
                type : 'garden',
                obstaclePoints :[{"x":997,"y":145},{"x":1002,"y":142},{"x":1003,"y":136},{"x":997,"y":135},
                {"x":993,"y":138},{"x":1021,"y":143},{"x":1028,"y":144},{"x":1029,"y":138},{"x":1030,"y":135},
                {"x":1022,"y":134},{"x":1021,"y":119},{"x":1026,"y":121},{"x":1030,"y":117},{"x":1028,"y":112},
                {"x":1021,"y":110},{"x":1020,"y":114},{"x":1004,"y":118},{"x":1002,"y":120},{"x":996,"y":121},
                {"x":994,"y":114},{"x":998,"y":110},{"x":1002,"y":112}]

            },
            '{"q":11,"r":1,"s":-12}': {
                type : 'garden',
                obstaclePoints :[{"x":598,"y":436},{"x":604,"y":436},{"x":605,"y":432},{"x":600,"y":428},
                {"x":596,"y":432},{"x":632,"y":442},{"x":636,"y":437},{"x":635,"y":433},{"x":630,"y":432},
                {"x":627,"y":437},{"x":627,"y":414},{"x":633,"y":417},{"x":638,"y":414},{"x":637,"y":409},
                {"x":630,"y":408},{"x":597,"y":412},{"x":602,"y":411},{"x":605,"y":406},{"x":601,"y":404},
                {"x":595,"y":407}]

            },
            '{"q":11,"r":2,"s":-13}': {
                type : 'garden',
                obstaclePoints :[{"x":601,"y":473},{"x":609,"y":472},{"x":609,"y":467},{"x":606,"y":461},
                {"x":600,"y":465},{"x":628,"y":466},{"x":633,"y":470},{"x":637,"y":468},{"x":638,"y":462},
                {"x":631,"y":459},{"x":637,"y":481},{"x":642,"y":479},{"x":646,"y":482},{"x":645,"y":487},
                {"x":641,"y":489},{"x":637,"y":486},{"x":606,"y":497},{"x":607,"y":489},{"x":599,"y":489},
                {"x":595,"y":491},{"x":597,"y":496},{"x":602,"y":500}]

            },
            '{"q":12,"r":2,"s":-14}': {
                type : 'garden',
                obstaclePoints :[{"x":667,"y":500},{"x":662,"y":500},{"x":659,"y":494},{"x":665,"y":493},
                {"x":667,"y":495},{"x":681,"y":499},{"x":687,"y":498},{"x":688,"y":494},{"x":683,"y":491},
                {"x":681,"y":495},{"x":690,"y":519},{"x":693,"y":515},{"x":698,"y":514},{"x":699,"y":522},
                {"x":694,"y":526},{"x":690,"y":525},{"x":674,"y":538},{"x":676,"y":535},{"x":675,"y":529},
                {"x":670,"y":529},{"x":666,"y":532},{"x":667,"y":537}]

            },
            '{"q":11,"r":3,"s":-14}': {
                type : 'garden',
                obstaclePoints :[{"x":606,"y":573},{"x":606,"y":566},{"x":612,"y":565},{"x":618,"y":565},
                {"x":621,"y":571},{"x":617,"y":574},{"x":610,"y":574},{"x":633,"y":561},{"x":638,"y":559},
                {"x":640,"y":555},{"x":639,"y":552},{"x":636,"y":548},{"x":631,"y":551},{"x":630,"y":555},
                {"x":599,"y":546},{"x":597,"y":541},{"x":591,"y":541},{"x":589,"y":544},{"x":589,"y":548},
                {"x":594,"y":549},{"x":609,"y":527},{"x":606,"y":523},{"x":601,"y":523},{"x":601,"y":530},
                {"x":606,"y":530}]
                
            },
        };
        this.tableOfFilledHexes = {}
        this.ownHex = undefined;
        this.flat = hexFunctions.Layout(hexFunctions.layout_flat, hexFunctions.Point(37.5, 37.5), hexFunctions.Point(0,0));//(-112,-33)); // refactor . We should get orient,size and orig from consttructor
        this.flatStarting = this.flat
        
        this.hex_CountersArrayHash = {};
    }
//------------------------------------------------------------------------------------------------
    fillHex_CountersArrayHash(hex1,counter) {
        
        let hex = JSON.stringify(hex1)

        if(this.hex_CountersArrayHash[hex]) {
            this.hex_CountersArrayHash[hex].push(counter)
        } else {
            this.hex_CountersArrayHash[hex] = [];
            this.hex_CountersArrayHash[hex].push(counter)
        }
    };

    emptyHex_CountersArrayHash(hex1,counter){

        let hex = JSON.stringify(hex1)
        
        let arr = this.hex_CountersArrayHash[hex]
        arr.splice(arr.indexOf(counter),1)
        if (arr.length == 0){
            delete this.hex_CountersArrayHash[hex]
        }
    }
//------------------------------------------------------------------------------------------------
    setFlat (flat) {
        this.flat = flat
    };

    setOwnHex(ownHex) {
        this.ownHex = ownHex
    };

    getHexesInLoS(hexClicked,hexFired) {

        let arr = hex_linedraw(hexFired,hexClicked);

        return arr
    };

    checkLoS(hexClicked,hexFired) {
        //console.log('hexes :',[hexClicked,hexFired])

        let terrainEffectModificator = 0;
        let result =  {los:true,tem:terrainEffectModificator}
        let centerOfOwnHex =  center_of_hex(this.flatStarting, hexFired);       // { x: num, y: num }
        let centerOfHexClicked = center_of_hex(this.flatStarting, hexClicked);
        let line1 = [centerOfOwnHex,centerOfHexClicked];                                // los to check


        let arrayOfHexesInLoS = this.getHexesInLoS(hexClicked,hexFired);

        //console.log('arrayOfHexesInLoS',arrayOfHexesInLoS)

        //return {'line1':line1,'arrayOfHexesInLoS':arrayOfHexesInLoS}
        for (let i of arrayOfHexesInLoS) {          //i = {q:,r,s}

        //console.log('checking Los in :',JSON.stringify(i))
        //console.log('its terrain type :',this.hexTerrainTable[JSON.stringify(i)])

            if (this.hexTerrainTable[JSON.stringify(i)] !== undefined) {
                //console.log(i)

                let terrainType = this.hexTerrainTable[JSON.stringify(i)].type;

                if ( terrainType === 'hill' || terrainType === 'wooden house' || terrainType === 'stone house' ) {

                    let obstacleLinesArray = this.hexTerrainTable[JSON.stringify(i)].obstacleLines;

                    for (let e of obstacleLinesArray) {         // e = [{"x":894,"y":81},{"x":881,"y":65}]

                        let result = doLineSegmentsIntersect(line1,e)
                        //if (doLineSegmentsIntersect(line1,e)) {
                        if (result.bool) {
                            console.log('No LoS !');
                            //console.log(JSON.stringify(i));

                            let p = result.obstaclePoint

                            return {los:false,tem:terrainEffectModificator,hexWithObstacle:i,'line1':line1,obstaclePoint:p}
                        };
                        
                        //return {los:true,tem:terrainEffectModificator}
                    }
                    console.log('continue checkng LoS !')
                };

                if ( terrainType === 'forest' ) {
                    
                    let obstaclePointsArray = this.hexTerrainTable[JSON.stringify(i)].obstaclePoints

                    //console.log('cause its type is forest let us get points array ',obstaclePointsArray)
                    for (let e of obstaclePointsArray) { // e = {"x":894,"y":81}
                        if(lineCircleCollide(centerOfOwnHex,centerOfHexClicked,e,3)) {    // (a, b, circle, radius)
                            console.log('No LoS !');
                            return {los:false,tem:terrainEffectModificator,'line1':line1,hexWithObstacle:i}
                        }   
                    }
                }
                if ( terrainType === 'garden' ) {
                    let obstaclePointsArray = this.hexTerrainTable[JSON.stringify(i)].obstaclePoints
                    for (let e of obstaclePointsArray) { 
                        if(lineCircleCollide(centerOfOwnHex,centerOfHexClicked,e,3)) {
                            console.log('garden !');
                            terrainEffectModificator +=1
                        }
                    }
                }
            }
        }
        return result

    };

    getPolyCorners(hex) {
        return hexFunctions.polygon_corners(this.flat, { q: hex.q, r: hex.r, s: hex.s })    // refactor (this.flat, hex)
    };

    getHexFromCoords (coords) {
        return hexFunctions.hex_round(hexFunctions.pixel_to_hex(this.flat,coords))
    };

    getSectorUnderCoords(coords,hex)  {
        let hexOnMouseOver = this.getHexFromCoords(coords);
        let newSector =  
            hexOnMouseOver.r - hex.r <= 0 && hexOnMouseOver.s - hex.s <= 0 ? 0 :
                hexOnMouseOver.q - hex.q >= 0 && hexOnMouseOver.r - hex.r >= 0 ? 1 :
                    hexOnMouseOver.s - hex.s <= 0 && hexOnMouseOver.q - hex.q <= 0 ? 2 :
                        hexOnMouseOver.r - hex.r >= 0 && hexOnMouseOver.s - hex.s >= 0 ? 3 :
                            hexOnMouseOver.q - hex.q <= 0 && hexOnMouseOver.r - hex.r <= 0 ? 4 :
                                5;
        return newSector
    };

    setNewFlatOrigin(x,y) {
        this.flat.origin = hexFunctions.Point(x, y)
    };

    getFlatOrigin() {
        return { x:this.flat.origin.x,y:this.flat.origin.y }
    };

    changeFlatOriginOnScreenMoving(coordsAfter,coordsBefore) {

        let o = this.getFlatOrigin() // {x:0,y:0}
        let b = coordsAfter // {x:N,y:M}
        let a = coordsBefore

        let newOriginX = o.x + b.x - a.x
        let newOriginY = o.y + b.y - a.y
        this.setNewFlatOrigin(newOriginX,newOriginY)

    };

    getTerrainType(hex) {
        let h = this.hexTerrainTable[JSON.stringify(hex)]
        if(h) {
            return h.type;
        } 
        return undefined
    };

    getHexTerrainTable () {
        return this.hexTerrainTable 
    };

//tools for filling emptying hexes --------------------------------------------------

    // getCenterOfHexForMoving(hex) {
    //     if (this.checkIfThisHexIsFree(hex)) { 
    //         return this.getCenterOfHex(hex)
    //     }        
    //     else {
            
    //         let center = this.getCenterOfHex(hex)
    //         return {x:center.x+20,y:center.y-20}
    //     }
    // };

    checkIfThisHexIsFree(hex) {

        return !this.tableOfFilledHexes[JSON.stringify(hex)]
    };

    getCenterOfHex(hex){
        return hexFunctions.hex_to_pixel (this.flat,hex)
    };

    // emptyHex (hex) {
    //     delete this.tableOfFilledHexes[JSON.stringify(hex)]
    // };
    
    // fillHex (hex) {
    //     this.tableOfFilledHexes[JSON.stringify(hex)] = true;
    // };

// d fire addon -----------------------------------------------------------------------------------------
    getnumberOfCountersIn(hex) {

        return this.tableOfFilledHexes[JSON.stringify(hex)]
    }

    fillHex (hex) {
        //console.log('filling hex')
        let numberOfCountersInHex = this.tableOfFilledHexes[JSON.stringify(hex)]
        //console.log('numberOfCountersInHex',numberOfCountersInHex)
        if (numberOfCountersInHex != undefined) {    // cheking if there is something in hex
            this.tableOfFilledHexes[JSON.stringify(hex)] = numberOfCountersInHex + 1
        } else {
            //console.log('we are first')
            this.tableOfFilledHexes[JSON.stringify(hex)] = 1
        }

    };

    emptyHex (hex) {

        let numberOfCountersInHex = this.tableOfFilledHexes[JSON.stringify(hex)]
        if (numberOfCountersInHex === 1) {
            delete this.tableOfFilledHexes[JSON.stringify(hex)]
        } else {
            this.tableOfFilledHexes[JSON.stringify(hex)] = numberOfCountersInHex - 1
        }
        
    };

    getCenterOfHexForMoving(hex) {

        //console.log('hex :',hex)
        let numberOfCountersInHex = this.tableOfFilledHexes[JSON.stringify(hex)]
        //console.log('numberOfCountersInHex :',numberOfCountersInHex)

        let center = this.getCenterOfHex(hex)

        if (this.checkIfThisHexIsFree(hex)) { 
            //console.log('this hex is free')
            return center
        }        
        else {

            return {x:center.x+10*numberOfCountersInHex,y:center.y-10*numberOfCountersInHex}
        }
    };
//----------------------------------------------------------------------------------------------------------


}


export {Map};